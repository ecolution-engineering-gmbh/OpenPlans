<!DOCTYPE html>
<html lang="en">

<head>
  <title>OpenPlans Slab</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="OpenGeometry Demo - Base Slab">
  <meta name="author" content="OpenGeometry Team">
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    #app {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>

<body>
  <div id="app" style="width: 100%; height: 100vh;">
  </div>
  <script type="module">
    import { OpenPlans } from './../../src/index.ts';
    import { GUI } from 'three/addons/libs/lil-gui.module.min.js';

    let openPlans;
    let slab;

    async function init() {
      const container = document.getElementById('app');
      openPlans = new OpenPlans(container);
      await openPlans.setupOpenGeometry();

      // Create a basic slab
      slab = openPlans.baseSlab();
    }

    function setUI() {
      const gui = new GUI();
      const slabFolder = gui.addFolder('Slab');
      const slabControls = {
        'color': '#CCCCCC',
        'width': 5,
        'length': 5,
        'thickness': 0.2,
        'selected': false,
        'material': 'concrete',
        'positionX': 0,
        'positionY': 0,
        'positionZ': 0,
      };

      const slabs = openPlans.getEntitiesByType('SLAB');
      slabs.forEach((slab) => {
        console.log('Slab:', slab);
        const subSlab = slabFolder.addFolder(slab.labelName);
        
        subSlab.addColor(slabControls, 'color').name('Color').onChange((value) => {
          slab.slabColor = parseInt(value.replace('#', '0x'));
        });
        
        subSlab.add(slabControls, 'width', 1, 10).name('Width').onChange((value) => {
          slab.slabWidth = value;
        });
        
        subSlab.add(slabControls, 'length', 1, 10).name('Length').onChange((value) => {
          slab.slabLength = value;
        });
        
        subSlab.add(slabControls, 'thickness', 0.1, 1).name('Thickness').onChange((value) => {
          slab.slabThickness = value;
        });

        subSlab.add(slabControls, 'positionX', -10, 10).name('Position X').onChange((value) => {
          const pos = slab.propertySet.slabPosition;
          slab.slabPosition = [value, pos[1], pos[2]];
        });

        subSlab.add(slabControls, 'positionY', -5, 5).name('Position Y').onChange((value) => {
          const pos = slab.propertySet.slabPosition;
          slab.slabPosition = [pos[0], value, pos[2]];
        });

        subSlab.add(slabControls, 'positionZ', -10, 10).name('Position Z').onChange((value) => {
          const pos = slab.propertySet.slabPosition;
          slab.slabPosition = [pos[0], pos[1], value];
        });
        
        subSlab.add(slabControls, 'selected').name('Selected').onChange((value) => {
          slab.selected = value;
        });

        subSlab.add({ config: () => {
          const config = slab.getOPConfig();
          console.log('Slab Config:', config);
        }}, 'config').name('Get Config');

        subSlab.add({ dispose: () => {
          console.log('Disposing slab:', slab.ogid);
          openPlans.disposeElement(slab.ogid);
        }}, 'dispose').name('Dispose');
      });

      const preloadFolder = gui.addFolder('Preload Slab');
      const preloadControls = {
        'selected': false,
        'width': 5,
        'length': 5,
        'thickness': 0.2,
        'showProfileView': false,
        'positionX': 3,
        'positionY': 0,
        'positionZ': 0,
      };

      preloadFolder.add(preloadControls, 'width', 1, 10).name('Width');
      preloadFolder.add(preloadControls, 'length', 1, 10).name('Length');
      preloadFolder.add(preloadControls, 'thickness', 0.1, 1).name('Thickness');
      preloadFolder.add(preloadControls, 'positionX', -10, 10).name('Position X');
      preloadFolder.add(preloadControls, 'positionY', -5, 5).name('Position Y');
      preloadFolder.add(preloadControls, 'positionZ', -10, 10).name('Position Z');
      preloadFolder.add(preloadControls, 'selected').name('Selected');
      preloadFolder.add(preloadControls, 'showProfileView').name('Show Profile View').onChange((value) => {
        const slabs = openPlans.getEntitiesByType('SLAB');
        slabs.forEach((slab) => {
          slab.showProfileView(value);
        });
      });

      preloadFolder.add({ 
        create: () => {
          const newSlab = openPlans.baseSlab({
            labelName: 'Custom Slab',
            type: 'SLAB',
            dimensions: {
              start: { x: -preloadControls.width / 2, y: 0, z: -preloadControls.length / 2 },
              end: { x: preloadControls.width / 2, y: 0, z: preloadControls.length / 2 },
              width: preloadControls.width,
              length: preloadControls.length,
            },
            slabPosition: [preloadControls.positionX, preloadControls.positionY, preloadControls.positionZ],
            slabThickness: preloadControls.thickness,
            slabColor: 0xCCCCCC,
            slabMaterial: 'concrete',
            coordinates: [],
          });
          console.log('Created new slab:', newSlab);
          setUI(); // Refresh UI to show new slab
        }
      }, 'create').name('Create Slab');
    }

    init().then(() => {
      setUI();
    });
  </script>
</body>

</html>
